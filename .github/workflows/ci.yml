name: ci
on: [push]
jobs:
  checks:
    runs-on: ubuntu-22.04
    steps:
      - name: Checkout 🛎️
        uses: actions/checkout@v4
      # https://github.com/cypress-io/github-action
      - name: Install 📦
        uses: cypress-io/github-action@v6
        with:
          start: npm start
          wait-on: 'http://127.0.0.1:3000'

      # generate image diffs
      - name: Generate image diffs 📸
        run: |
          npx odiff --diff-color=#ff00ff \
          cypress/gold/login.cy.ts/login-page.png \
          cypress/screenshots/login.cy.ts/login-page.png \
          cypress/screenshots/login-page-diff.png
          # the second image
          npx odiff --diff-color=#ff00ff \
          cypress/gold/login.cy.ts/login-error.png \
          cypress/screenshots/login.cy.ts/login-error.png \
          cypress/screenshots/login-error-diff.png

      # after the test run completes store the screenshots and diffs
      - name: Save screenshots 📸
        uses: actions/upload-artifact@v4
        with:
          name: cypress-screenshots
          path: cypress/screenshots
          if-no-files-found: ignore
